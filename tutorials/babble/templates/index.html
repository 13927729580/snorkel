{% extends "layout.html" %}
{% block content %}

          <!-- Modal -->
      <div id="labelModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Evaluation Metrics</h4>
            </div>
            <div class="modal-body">
              {{ metrics.lf_stats| safe }}
          </div>
          <div class="modal-footer">
            <small class="text-muted">This demo was built by Stephanie Wang and Braden Hancock</small>
          </div>
        </div>

      </div>
    </div>
          <!-- Modal -->
      <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Welcome to Babble Labble</h4>
            </div>
            <div class="modal-body">
              <p>In this demo, you are writing <em>weak supervision</em> rules for generating training data. These rules can be used to generated massive amounts of training data for training your favorite deep learning model.</p>
              <p>You will be shown a sentence with two entities highlighted (call them X and Y)</p>
              <p>First, mark a <strong>label</strong> <font color="green">True</font> or <font color="red">False</font> for the statement: "<mark>X</mark> and <mark>Y</mark> were/are/will be married."<br/>
              Second, write an <strong>explanation</strong> for why you gave the label you did.<br/>
              Press "Parse" to view the Accuracy and Coverage of you explanation. If you are happy with your result, press "Submit"<br/>
              Otherwise, modify your explanation or push the <font color="DarkGray">Skip</font> button.</p>
              <p>For best results:</p>
              <ul>
                <li> Start your explanation with the word "because" and refer to the people as "<mark>X</mark>" and "<mark>Y</mark>"</li>
                <li>Put words that you are quoting from in the text in double quotes</li>
                <li>Base your explanations on words in the sentence using properties such as spelling, capitalization, keywords and distances between words.</li>
              </ul>
              <p>We will walk you through the first few explanations to get you started!</p>
          </div>
          <div class="modal-footer">
            <small class="text-muted">This demo was built by Stephanie Wang and Braden Hancock</small>
          </div>
        </div>

      </div>
    </div>
      <div id="left"> <h1 style="color: #ffffff; text-align: center"> Babble Labble </h1>
        <!-- Trigger the modal with a button -->
      <div class="information" id="left-metrics">
        <button class="button button-plain button-borderless" data-toggle="modal" data-target="#myModal">Help</button>
        <h4>Coverage {{'%0.2f' % metrics.coverage|float}}%</h4>
<!--         <div class="progress" style="height: 7px;">
          <div class="progress-bar" role="progressbar" style="width: {{'%0.2f' % metrics.coverage|float}}%;" aria-valuenow={{metrics.coverage}} aria-valuemin="0" aria-valuemax="100"></div>
        </div> -->
        <h4>Labels {{metrics.num_labels}}</h4>
        <h4>Examples Seen {{metrics.num_examples}}</h4>
        <button style="text-align: center;" class="button button-rounded" data-toggle="modal" data-target="#labelModal">Previous Labels</button>
      </div>
      <form method=post style="text-align: center; margin-top: 5%">
        <input class="button button-action button-rounded" type=submit name=finish value="Train Model"></input>
      </form>
      </div>

<div id="right">
  <p style="font-size:14pt; margin-top: 2%; padding:5pt 10pt 5pt 0pt; text-align:center;"> Label whether
    <b style="background-color:#ffd77c;padding:1pt 5pt 1pt 5pt;">X</b>and 
    <b style="background-color:#ffd77c;padding:1pt 5pt 1pt 5pt;">Y</b> were/are/will be married</p>
<p>{{candidate|safe}}</p>

{% from "_formhelpers.html" import render_field %}
<script type="text/javascript">// <![CDATA[
        function loading(){
            $("#loading").show();
            $("#content").hide();       
        }
// ]]></script>
<div id="loading"></div>
<div id="content">
	<form method=post style="text-align: center; width: 70%; margin: auto; padding-top: 4%">
	  <dl>
	  	{{ form.csrf_token }}
	  	<div class="form-group {% if form.explanation.errors %} has-error {% endif %}">
	    	{{ form.explanation(cols="10", rows="2", placeholder="Think of a label for this sentence, and give an explanation for your label here. Then submit your explanation by selecting the label below.", class="form-control") }}
         <p class="col-sm-12 help-block">
            {{ form.explanation.errors[0] }}
		</div>
	  </dl>
     <br/>
        <input class="button button-action button-square button-giant" type=submit name=pos onclick="loading();" value="&#xE145;"></input>
        <input class="button button-caution button-square button-giant" type=submit name=neg onclick="loading();" value="&#xE15B;"></input>
        <input class="button button-square button-giant" type=submit name=skip onclick="loading();" value="&#xE14B;"></input>
	</form>

  {% if stats is defined %}

  <div id="stats-tabs">
  <ul class="nav nav-tabs">
    {% for tup in stats %}
      <li class="{% if loop.index == 1 %}active{% endif %}"><a data-toggle="tab" href="#parse_{{loop.index}}">Parse {{loop.index}}</a></li>
    {% endfor %}
  </ul>

  <div class="tab-content">
    {% for tup in stats %}
    <div id="parse_{{loop.index}}" class="tab-pane fade in {% if loop.index == 1 %}in active{% endif %}">
    <br/>
    <div class="row">
      {% set accuracy = tup[2].accuracy.numer / tup[2].accuracy.denom * 100 %}
      <div class="col-sm-6"><h4>Accuracy</h4> <span style="font-size: 18px">{{'%0.2f' % accuracy|float}}% ({{tup[2].accuracy.numer}} / {{tup[2].accuracy.denom}})</span></div>
      {% set coverage = tup[2].class_coverage.numer / tup[2].class_coverage.denom * 100 %}
      <div class="cols-sm-6"><h4>Coverage</h4> <span style="font-size: 18px">{{'%0.2f' % coverage|float}}% ({{tup[2].class_coverage.numer}} / {{tup[2].class_coverage.denom}})</span></div>
    </div>
  </div>

    <h4 style="margin-top: 2%">Labeling Function</h4>
      <code style="text-align: center; font-size: 16px">{{tup[0]}}</code>

    <h4 style="margin-top: 2%">
      <a href="#correct" data-toggle="collapse"> View Correct and Incorrect</a>
    </h4>
    <div id="correct" class="collapse">
        <div class="row">
            <div class="col-sm-6">
              <ul class="list-group">
              {% for sample in tup[1].correct[:3] %}
              <li class="list-group-item list-group-item-success">{{ sample|safe }}</li>
              {% endfor %}
            </ul>
        </div>
        <div class="col-sm-6">
            <ul class="list-group">
            {% for sample in tup[1].incorrect[:3]%}
            <li class="list-group-item list-group-item-danger">{{ sample|safe }}</li>
            {% endfor %}
            </ul>
          </div>
      </div>
    </div>

      {% if filtered_analysis is not none %}
      <h4 style="margin-top: 2%"><a href="#filtered" data-toggle="collapse">Filtered Parses</a></h4>
      <div id="filtered" class="collapse">
        {{filtered_analysis|safe}}
      </div>
    {% endif %}
  </div>
    {% endfor %}
  </div>
</div>
  <form method=post style="text-align: center; margin-top: 5%">
  <input class="button button-action button-rounded" type=submit name=commit value="Commit"></input>
</form>
  {% endif %}

  {% if no_parse_error is defined %}
  <p style="text-align: center; margin-top: 5%">Your explanation generated no valid parses -- check your explanation, revisit the <a data-toggle="modal" data-target="#myModal">instructions</a>, or skip this example.</p>
    {% if filtered_analysis is not none %}
    <div class="panel panel-default" style="width=70% padding:5pt 10pt 5pt 0pt">
      <div class="panel-body">
        <div id="filtered-tab">
          {{filtered_analysis|safe}}
        </div>
      </div>
    </div>
    {% endif %}
  {% endif %}
  </div>
</div>
  {% endblock %}